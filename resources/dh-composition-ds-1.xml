<?xml version="1.0" encoding="utf-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
  <id value="dh-composition-ds-1"/>
  <url value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-composition-ds-1"/>
  <version value="0.0.2"/>
  <name value="DHCompositionDS"/>
  <title value="Australian Digital Health Agency Discharge Summary Composition"/>
  <status value="draft"/>
  <experimental value="false"/>
  <publisher value="Australian Digital Health Agency"/>
  <contact>
    <telecom>
      <system value="email"/>
      <value value="help@digitalhealth.gov.au"/>
    </telecom>
  </contact>
  <description
    value="The purpose of this profile is to define a representation of an Discharge Summary document for a patient for the electronic exchange of health information between individuals, healthcare providers, and the My Health Record system infrastructure in Australia. This profile standardises the core, common or critical information for exchange of information between healthcare providers, and individual, to support continuity of care following discharge. A composition is a set of resources composed into a single coherent clinical statement that may have clinical attestation."/>
  <copyright
    value="Copyright © 2022 Australian Digital Health Agency - All rights reserved. Except for the material identified below, this content is licensed under a Creative Commons Attribution 4.0 International License. See https://creativecommons.org/licenses/by/4.0/. &#xa;&#xa;This material contains content from LOINC (http://loinc.org). LOINC is copyright © 1995-2021, Regenstrief Institute, Inc. and the Logical Observation Identifiers Names and Codes (LOINC) Committee and is available at no cost under the license at http://loinc.org/license. LOINC® is a registered United States trademark of Regenstrief Institute, Inc.&#xa;&#xa;All copies of this resource must include this copyright statement and all information contained in this statement."/>
  <fhirVersion value="4.0.1"/>
  <kind value="resource"/>
  <abstract value="false"/>
  <type value="Composition"/>
  <baseDefinition
    value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-composition-document-1"/>
  <derivation value="constraint"/>
  <differential>
    <element id="Composition">
      <path value="Composition"/>
      <short value="Discharge Summary"/>
      <definition value="A discharge summary document supports the exchange of core, common, or critical information for exchange between healthcare providers, and individual, to support continuity of care to support continuity of care following discharge."/>
      <constraint>
        <key value="inv-dh-ds-01"/>
        <severity value="error"/>
        <human value="One record type (category) shall be Discharge Summary '18842-5' 'http://loinc.org'"/>
        <expression value="category.coding.where(system='http://loinc.org' and code='18842-5').exists()"/>
        <source value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-composition-ds-1"/>
      </constraint>
    </element>
    <element id="Composition.status">
      <path value="Composition.status"/>
      <patternCode value="final"/>
    </element>
    <element id="Composition.author">
      <path value="Composition.author"/>
      <type>
        <code value="Reference"/>
        <targetProfile
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-practitionerrole-author-1"
        />
      </type>
    </element>
    <element id="Composition.section">
      <path value="Composition.section"/>
      <slicing>
        <discriminator>
          <type value="pattern"/>
          <path value="code"/>
        </discriminator>
        <rules value="open"/>
      </slicing>
      <constraint>
        <key value="inv-dh-ds-01"/>
        <severity value="error"/>
        <human value="A section shall at least have an entry or an empty reason, but not both"/>
        <expression value="entry.exists() xor emptyReason.exists()"/>
        <source
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-composition-ds-1"/>
      </constraint>
      <constraint>
        <key value="inv-dh-ds-02"/>
        <severity value="error"/>
        <human
          value="All observations shall conform one of: ADHA Simple Observation, ADHA Diagnostic Result Group Observation, ADHA Diagnostic Result Observation"/>
        <expression
          value="entry.resolve().where($this is Observation).exists() implies entry.resolve().conformsTo('http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-observation-diagnosticresultgroup-1') or entry.resolve().conformsTo('http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-observation-diagnosticresult-1')"/>
        <source
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-composition-ds-1"/>
      </constraint>
    </element>
    <element id="Composition.section.title">
      <path value="Composition.section.title"/>
      <min value="1"/>
    </element>
    <element id="Composition.section.code">
      <path value="Composition.section.code"/>
      <min value="1"/>
    </element>
    <element id="Composition.section.emptyReason">
      <path value="Composition.section.emptyReason"/>
      <binding>
        <strength value="required"/>
        <valueSet
          value="https://healthterminologies.gov.au/fhir/ValueSet/health-summary-non-clinical-empty-reason-2"
        />
      </binding>
    </element>
    <element id="Composition.section:advanceCareDirectives">
      <path value="Composition.section"/>
      <sliceName value="advanceCareDirectives"/>
      <short value="Information on advance care directives."/>
      <definition value="TBD"/>
      <max value="1"/>
    </element>
    <element id="Composition.section:advanceCareDirectives.code">
      <path value="Composition.section.code"/>
      <patternCodeableConcept>
        <coding>
          <system value="http://loinc.org"/>
          <code value="42348-3"/>
        </coding>
      </patternCodeableConcept>
    </element>
    <element id="Composition.section:advanceCareDirectives.entry">
      <path value="Composition.section.entry"/>
      <type>
        <code value="Reference"/>
        <targetProfile
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-consent-core-1"
        />
        <targetProfile
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-documentreference-core-1"
        />
        <targetProfile
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-documentreference-acp-1"
        />
      </type>
    </element>
    <element id="Composition.section:allergies">
      <path value="Composition.section"/>
      <sliceName value="allergies"/>
      <short value="Allergies"/>
      <definition
        value="Information about allergies or intolerances identified or reported during this encounter. This may include statements that a patient does not have an allergy or category of allergies."/>
      <max value="1"/>
    </element>
    <element id="Composition.section:allergies.code">
      <path value="Composition.section.code"/>
      <patternCodeableConcept>
        <coding>
          <system value="http://loinc.org"/>
          <code value="48765-2"/>
        </coding>
      </patternCodeableConcept>
    </element>
    <element id="Composition.section:allergies.entry">
      <path value="Composition.section.entry"/>
      <type>
        <code value="Reference"/>
        <targetProfile
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-allergyintolerance-core-1"
        />
      </type>
    </element>
    <element id="Composition.section:dischargeMedicines">
      <path value="Composition.section"/>
      <sliceName value="dischargeMedicines"/>
      <short value="Medicines on discharge"/>
      <definition
        value="Information on the medicines that the patient is intended to take (or stop) after discharge. This may be a list, and the source may be indicated, for example, from a pharmacy system versus from the patient."/>
      <max value="1"/>
      <constraint>
        <key value="inv-dh-ds-03"/>
        <severity value="error"/>
        <human value="This section shall not contain a mix of resource types"/>
        <expression
          value="entry.resolve().where($this is Immunization).exists() xor entry.resolve().where($this is Observation).exists() xor entry.resolve().where($this is List).exists()"/>
        <source
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-composition-ds-1"/>
      </constraint>
      <constraint>
        <key value="inv-dh-ds-04"/>
        <severity value="error"/>
        <human
          value="At most one assertion of no relevant finding shall be present"/>
        <expression
          value="entry.resolve().where($this is Observation).exists() implies (entry.resolve().where($this is Observation).count() &lt; 2"/>
        <source
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-composition-ds-1"/>
      </constraint>
      <constraint>
        <key value="inv-dh-ds-05"/>
        <severity value="error"/>
        <human
          value="At most one list shall be present"/>
        <expression
          value="entry.resolve().where($this is List).exists() implies (entry.resolve().where($this is List).count() &lt; 2"/>
        <source
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-composition-ds-1"/>
      </constraint>
    </element>
    <element id="Composition.section:dischargeMedicines.code">
      <path value="Composition.section.code"/>
      <patternCodeableConcept>
        <coding>
          <system value="http://loinc.org"/>
          <code value="10183-2"/>
        </coding>
      </patternCodeableConcept>
    </element>
    <element id="Composition.section:dischargeMedicines.entry">
      <path value="Composition.section.entry"/>
      <type>
        <code value="Reference"/>
        <targetProfile value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-list-medication-use-1"/>
        <targetProfile
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-medicationstatement-core-1"/>
        <targetProfile value="http://hl7.org.au/fhir/StructureDefinition/au-norelevantfinding"/>
      </type>
    </element>
    <element id="Composition.section:admissionMedicines">
      <path value="Composition.section"/>
      <sliceName value="admissionMedicines"/>
      <short value="Medicines on admission"/>
      <definition
        value="Information on the patient's medicine item use on admission."/>
      <max value="1"/>
      <constraint>
        <key value="inv-dh-ds-07"/>
        <severity value="error"/>
        <human value="This section shall not contain a mix of resource types"/>
        <expression
          value="entry.resolve().where($this is MedicationStatement).exists() xor entry.resolve().where($this is Observation).exists() xor entry.resolve().where($this is List).exists()"/>
        <source
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-composition-ds-1"/>
      </constraint>
      <constraint>
        <key value="inv-dh-ds-08"/>
        <severity value="error"/>
        <human
          value="At most one assertion of no relevant finding shall be present and it shall assert no known current medications"/>
        <expression
          value="entry.resolve().where($this is Observation).exists() implies (entry.resolve().where($this is Observation).count() &lt; 2 and entry.resolve().where($this is Observation.value and Observation.value.coding.code = '1200661000168107').exists())"/>
        <source
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-composition-ds-1"/>
      </constraint>
      <constraint>
        <key value="inv-dh-ds-09"/>
        <severity value="error"/>
        <human
          value="At most one list shall be present"/>
        <expression
          value="entry.resolve().where($this is List).exists() implies (entry.resolve().where($this is List).count() &lt; 2"/>
        <source
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-composition-ds-1"/>
      </constraint>
    </element>
    <element id="Composition.section:admissionMedicines.code">
      <path value="Composition.section.code"/>
      <patternCodeableConcept>
        <coding>
          <system value="http://loinc.org"/>
          <code value="42346-7"/>
        </coding>
      </patternCodeableConcept>
    </element>
    <element id="Composition.section:admissionMedicines.entry">
      <path value="Composition.section.entry"/>
      <type>
        <code value="Reference"/>
        <targetProfile value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-list-medication-use-1"/>
        <targetProfile
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-medicationstatement-core-1"/>
        <targetProfile value="http://hl7.org.au/fhir/StructureDefinition/au-norelevantfinding"/>
      </type>
    </element>
    <element id="Composition.section:vitalSigns">
      <path value="Composition.section"/>
      <sliceName value="vitalSigns"/>
      <short value="Vital signs"/>
      <definition
        value="Vital signs associated with a patient."/>
      <max value="1"/>
    </element>
    <element id="Composition.section:vitalSigns.code">
      <path value="Composition.section.code"/>
      <patternCodeableConcept>
        <coding>
          <system value="http://loinc.org"/>
          <code value="8716-3"/>
        </coding>
      </patternCodeableConcept>
    </element>
    <element id="Composition.section:vitalSigns.entry">
      <path value="Composition.section.entry"/>
      <type>
        <code value="Reference"/>
        <targetProfile
          value="http://hl7.org.au/fhir/StructureDefinition/au-vitalspanel"
        />
        <targetProfile
          value="http://hl7.org.au/fhir/StructureDefinition/au-bloodpressure"
        />
        <targetProfile
          value="http://hl7.org.au/fhir/StructureDefinition/au-bodyweight"
        />
        <targetProfile
          value="http://hl7.org.au/fhir/StructureDefinition/au-bodyheight"
        />
        <targetProfile
          value="http://hl7.org.au/fhir/StructureDefinition/au-bmi"
        />
        <targetProfile
          value="http://hl7.org.au/fhir/StructureDefinition/au-oxygensat"
        />
        <targetProfile
          value="http://hl7.org.au/fhir/StructureDefinition/au-headcircum"
        />
        <targetProfile
          value="http://hl7.org.au/fhir/StructureDefinition/au-heartrate"
        />
        <targetProfile
          value="http://hl7.org.au/fhir/StructureDefinition/au-bodytemp"
        />
        <targetProfile
          value="http://hl7.org.au/fhir/StructureDefinition/au-resprate"
        />
      </type>
    </element>
    <element id="Composition.section:immunisations">
      <path value="Composition.section"/>
      <sliceName value="immunisations"/>
      <short value="Immunisations"/>
      <definition
        value="Information about the immunisation history, i.e. administered vaccines, of a patient."/>
      <max value="1"/>
      <constraint>
        <key value="inv-dh-ds-10"/>
        <severity value="error"/>
        <human value="This section shall not contain a mix of resource types"/>
        <expression
          value="entry.resolve().where($this is Immunization).exists() xor entry.resolve().where($this is Observation).exists() xor entry.resolve().where($this is List).exists()"/>
        <source
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-composition-ds-1"/>
      </constraint>
      <constraint>
        <key value="inv-dh-ds-11"/>
        <severity value="error"/>
        <human
          value="At most one assertion of no relevant finding shall be present and it shall assert no history of vaccination"/>
        <expression
          value="entry.resolve().where($this is Observation).exists() implies (entry.resolve().where($this is Observation).count() &lt; 2 and entry.resolve().where($this is Observation and Observation.value.coding.code='1234401000168109').exists())"/>
        <source
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-composition-ds-1"/>
      </constraint>
      <constraint>
        <key value="inv-dh-ds-12"/>
        <severity value="error"/>
        <human
          value="At most one list shall be present"/>
        <expression
          value="entry.resolve().where($this is List).exists() implies (entry.resolve().where($this is List).count() &lt; 2"/>
        <source
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-composition-ds-1"/>
      </constraint>
    </element>
    <element id="Composition.section:immunisations.code">
      <path value="Composition.section.code"/>
      <patternCodeableConcept>
        <coding>
          <system value="http://loinc.org"/>
          <code value="11369-6"/>
        </coding>
      </patternCodeableConcept>
    </element>
    <element id="Composition.section:immunisations.entry">
      <path value="Composition.section.entry"/>
      <type>
        <code value="Reference"/>
        <targetProfile value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-list-immunization-1"/>
        <targetProfile
          value="http://ns.electronichealth.net.au/fhir/StructureDefinition/dh-immunization-core-1"/>
        <targetProfile value="http://hl7.org.au/fhir/StructureDefinition/au-norelevantfinding"/>
      </type>
    </element>
  </differential>
</StructureDefinition>
